<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.domain.mapper.UserMapper">
	<!--whereの右辺を改行したくない -->
	<select id="findUserCredentialsByEmail"
		resultType="com.example.domain.model.entity.User">
		select user_id, password, role
		from `user`
		where email =
		#{email}
	</select>

	<select id="isPhoneNumberUnique" resultType="boolean">
		SELECT NOT EXISTS
		(
		SELECT 1
		FROM user
		WHERE phone_number = #{phoneNumber}
		)
	</select>

	<select id="isEmailUnique" resultType="boolean">
		SELECT NOT EXISTS (
		SELECT
		1
		FROM user
		WHERE email = #{email}
		)
	</select>

	<insert id="registerUser">
		INSERT INTO `user` (
		user_id,
		email,
		password,
		first_name_kanji,
		last_name_kanji,
		first_name_kana,
		last_name_kana,
		gender,
		birth_date,
		post_code,
		prefecture_id,
		address1,
		<if test="address2 != null">
			address2,
		</if>
		phone_number,
		role
		) VALUES (
		#{userId},
		#{email},
		#{password},
		#{firstNameKanji},
		#{lastNameKanji},
		#{firstNameKana},
		#{lastNameKana},
		#{gender},
		#{birthDate},
		#{postCode},
		#{prefectureId},
		#{address1},
		<if test="address2 != null">
			#{address2},
		</if>
		#{phoneNumber},
		#{role}
		);
	</insert>

</mapper>